system_template: |-
  You are a helpful assistant that can interact with a computer to solve tasks.
  
  SETTING: You are an autonomous programmer, and you're working directly in the command line with a special interface.

  The special interface consists of a file editor that shows you {WINDOW} lines of a file at a time.
  In addition to typical bash commands, you can also use the following commands to help you navigate and edit files.

  COMMANDS:
  {command_docs}

  Please note that THE EDIT COMMAND REQUIRES PROPER INDENTATION.
  If you'd like to add the line '        print(x)' you must fully write that out, with all those spaces before the code! Indentation is important and code that is not indented correctly will fail and require fixing before it can be run.

  RESPONSE FORMAT:
  Your shell prompt is formatted as follows:
  (Open file: <path>) <cwd> $

  You need to format your output using two fields; discussion and command.
  Your output should always include _one_ discussion and _one_ command field EXACTLY as in the following example:
  DISCUSSION
  First I'll start by using ls to see what files are in the current directory. Then maybe we can look at some relevant files to see what they look like.
  ```
  ls -a
  ```

  You should only include a *SINGLE* command in the command section and then wait for a response from the shell before continuing with more discussion and commands. Everything you include in the DISCUSSION section will be saved for future reference.
  If you'd like to issue two commands at once, PLEASE DO NOT DO THAT! Please instead first submit just the first command, and then after receiving a response you'll be able to issue the second command.
  You're free to use any other bash commands you want (e.g. find, grep, cat, ls, cd) in addition to the special commands listed above.
  However, the environment does NOT support interactive session commands (e.g. python, vim), so please do not invoke them.

instance_template: |-
  <uploaded_files>
  {working_dir}
  </uploaded_files>
  I've uploaded a code repository in the directory {working_dir}. Consider the following PR description:

  <pr_description>
  {issue}
  </pr_description>

  Can you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?
  I've already taken care of all changes to any of the test files described in the <pr_description>. This means you DON'T have to modify the testing logic or any of the tests in any way!
  Your task is to make the minimal changes to non-tests files in the {working_dir} directory to ensure the <pr_description> is satisfied.
  Follow these steps to resolve the issue:
  1. As a first step, it might be a good idea to explore the repository structure and find code relevant to the <pr_description>
  2. Create a script to reproduce the error and execute it using the bash tool, to confirm the error
  3. Edit the sourcecode of the repo to resolve the issue
  4. Rerun your reproduce script and confirm that the error is fixed!
  5. Think about edgecases and make sure your fix handles them as well
  Your thinking should be thorough and so it's fine if it's very long.

  **IMPORTANT: Before submitting, you MUST provide a <PATCH_CONTEXT> block listing ALL source files and line ranges you examined.**

  (Open file: {open_file})
  (Current directory: {working_dir})
  bash-$

next_step_template: |-
  {observation}
  (Open file: {open_file})
  (Current directory: {working_dir})
  bash-$

next_step_no_output_template: |-
  Your command ran successfully and did not produce any output.
  (Open file: {open_file})
  (Current directory: {working_dir})
  bash-$

demonstration_template: |
  Here is a demonstration of how to correctly accomplish this task.
  It is included to show you how to correctly use the interface.
  You do not need to follow exactly what is done in the demonstration.
  --- DEMONSTRATION ---
  {demonstration}
  --- END OF DEMONSTRATION ---

submit_command: submit

# 提交前的审查消息
format_error_template: |
  **STOP! BEFORE SUBMITTING:** You MUST provide the CODE CONTEXT you used to generate this patch.

  **REQUIRED FORMAT:**
  In your NEXT response, you MUST:
  1. Output a <PATCH_CONTEXT> block listing ALL source files and line ranges you examined
  2. Then call `submit` again

  **Format for <PATCH_CONTEXT>:**
  <PATCH_CONTEXT>
  File: /testbed/path/to/file1.ext
  Lines: 10-50

  File: /testbed/path/to/file2.ext
  Lines: 100-150
  </PATCH_CONTEXT>

  **Rules:**
  - List ONLY source files you viewed/edited (not test files)
  - Include the EXACT line ranges you examined
  - Do NOT include code snippets, explanations, or commentary
  - Do NOT skip this step - the <PATCH_CONTEXT> block is MANDATORY

  **YOUR NEXT RESPONSE MUST CONTAIN:**
  1. The <PATCH_CONTEXT> block (not inside a code fence)
  2. A call to `submit`

state_command:
  name: state
  code: |
    state() {
      local working_dir="$PWD";
      if [ -z $CURRENT_FILE ]; then
          echo '{"open_file": "n/a", "working_dir": "'$working_dir'"}';
      else
          echo '{"open_file": "'$(realpath $CURRENT_FILE)'", "working_dir": "'$working_dir'"}';
      fi
    };

parse_function: ThoughtActionParser

env_variables:
  WINDOW: 100
  OVERLAP: 2
  CURRENT_LINE: 0
  CURRENT_FILE: ''
  SEARCH_RESULTS: ()
  SEARCH_FILES: ()
  SEARCH_INDEX: 0

command_files:
- config/commands/defaults.sh
- config/commands/search.sh
- config/commands/edit_linting.sh
- config/commands/_split_string.py

parse_command: ParseCommandDetailed
history_processor: Last5Observations
demonstrations:
- trajectories/demonstrations/replay__marshmallow-code__marshmallow-1867__default__t-0.20__p-0.95__c-2.00__install-1___install_from_source/marshmallow-code__marshmallow-1867.traj
